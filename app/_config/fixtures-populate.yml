---
Name: essentials-fixtures-populate-config
Only:
  environment: 'dev'
---
DNADesign\Populate\Populate:
  include_yaml_fixtures:
    - 'vendor/dynamic/recipe-silverstripe-essentials-fixtures/app/fixtures/site-demo-content.yml'
    - 'vendor/dynamic/recipe-silverstripe-essentials-fixtures/app/fixtures/template-preview-images.yml'
    - 'vendor/dynamic/recipe-silverstripe-essentials-fixtures/app/fixtures/element-template-library.yml'
    - 'vendor/dynamic/recipe-silverstripe-essentials-fixtures/app/fixtures/element-template-expanded.yml'
  
  # Minimal truncate - only assets due to populate module merge bug
  # File/Image merging with PopulateMergeAny causes issues, so we truncate them
  # All other content uses PopulateMergeMatch for safe updates
  truncate_objects:
    - SilverStripe\Assets\File
  truncate_tables: []

---
Name: essentials-fixtures-extensions
---
# Disable default Silverstripe pages (Home, About Us, Contact Us) on dev/build
# Our fixtures will create these pages with proper content
# Also applies FixtureRecordExtension for merge matching
SilverStripe\CMS\Model\SiteTree:
  create_default_pages: false
  extensions:
    - FixtureRecordExtension

# Apply FixtureRecordExtension to base classes for populate merge protection
# This adds FixtureIdentifier field used by PopulateMergeMatch to prevent
# overwriting user-created content that happens to share fixture titles

DNADesign\Elemental\Models\BaseElement:
  extensions:
    - FixtureRecordExtension

Dynamic\BaseObject\Model\BaseElementObject:
  extensions:
    - FixtureRecordExtension

Dynamic\ElementalTemplates\Models\Template:
  extensions:
    - FixtureRecordExtension

# Child models that don't extend base classes
Dynamic\Elements\StatCounters\Model\StatCounter:
  extensions:
    - FixtureRecordExtension

Dynamic\Elements\Model\Testimonial:
  extensions:
    - FixtureRecordExtension

SilverStripe\LinkField\Models\Link:
  extensions:
    - FixtureRecordExtension

SilverStripe\Blog\Model\Blog:
  extensions:
    - FixtureRecordExtension
